import{a as f,h as u,i as p,m as U}from"./chunk-YNVE3HA7.js";import{A as h,D as d,y as m,z as l}from"./chunk-B24WKKOI.js";import{a as c,d as i,r as g,u as n,xa as w}from"./chunk-VOBVLZ74.js";var S=class a{constructor(e,t,r){this.auth=e;this.firestore=t;this.router=r}currentUser;registerUser(e,t,r="member"){return i(this,null,function*(){e==="alice.admin@example.com"&&(r="admin");let s=yield d(this.auth,e,t),o={uid:s.user.uid,email:e,role:r},I=u(this.firestore,`users/${s.user.uid}`);yield U(I,o)})}login(e,t){return i(this,null,function*(){try{console.log("Attempting to log in with email:",e);let r=yield m(this.auth,e,t);console.log("Authentication successful, user:",r.user);let s=u(this.firestore,`users/${r.user.uid}`);console.log("Fetching user document from Firestore:",s);let o=yield p(s);if(console.log("Firestore user document fetched:",o.data()),o.exists())this.currentUser=c({uid:r.user.uid},o.data()),console.log("Setting sessionStorage with user:",this.currentUser),sessionStorage.setItem("user",JSON.stringify(this.currentUser)),console.log("User stored in sessionStorage:",sessionStorage.getItem("user"));else throw new Error("User data not found in Firestore")}catch(r){throw console.error("Error during login:",r),r}})}getRole(){let e=sessionStorage.getItem("user");return e&&(this.currentUser=JSON.parse(e)),this.currentUser?.role}getLoggedInUser(){let e=sessionStorage.getItem("user");return console.log("getting logged in user:",sessionStorage.getItem("user")),e&&(this.currentUser=JSON.parse(e)),this.currentUser}logout(){return i(this,null,function*(){yield l(this.auth),this.currentUser=null,sessionStorage.removeItem("user"),this.router.navigate(["/login"])})}static \u0275fac=function(t){return new(t||a)(n(h),n(f),n(w))};static \u0275prov=g({token:a,factory:a.\u0275fac,providedIn:"root"})};export{S as a};
